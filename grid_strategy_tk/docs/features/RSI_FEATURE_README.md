# 分时图RSI指标和移动平均线功能说明

## 功能概述

在分时窗口中新增了RSI（相对强弱指数）指标图，显示在成交量图下方，为分时交易提供技术分析支持。

## 新增文件

### `src/indicators.py`
- 技术指标计算工具文件
- 包含RSI计算函数，支持单个和多个周期计算
- 使用指数移动平均（EMA）方法计算RSI

## 功能特性

### RSI指标图
- **位置**: 成交量图下方，作为第四个子图
- **高度**: 与其他子图保持一致（height_ratios=[1, 1, 1, 1]）
- **更新频率**: 与分时数据同步，1分钟级别更新

### RSI曲线
- **RSI6**: 蓝色实线，短期RSI
- **RSI12**: 橙色实线，中期RSI  
- **RSI24**: 绿色实线，长期RSI

### 超买超卖水平线
- **70**: 红色虚线，超买线
- **30**: 绿色虚线，超卖线
- **50**: 灰色实线，中性线

### 左上角信息显示
- **RSI数值**: 合并显示格式"RSI6: XX,XX,XX"，包含RSI6、RSI12、RSI24三个数值
- **颜色编码**: 整体颜色根据RSI状态智能选择：超买(红色)、超卖(绿色)、中性(橙色)
- **布局**: 参考平均成本图表的价差排版，显示在图表左上角
- **显示优化**: 三个文字框合并为一个，界面更简洁

## 技术实现

### 数据计算
```python
# 在数据更新时计算RSI
rsi_6 = calculate_rsi(price_df, period=6, price_col="close")
rsi_12 = calculate_rsi(price_df, period=12, price_col="close")
rsi_24 = calculate_rsi(price_df, period=24, price_col="close")
```

### 图表布局
- 修改了`Figure`尺寸：嵌入模式(6, 1.8)，独立模式(8, 6.5)，减少空白
- 使用`GridSpec`创建4个子图布局，高度比例[1, 1, 1, 1]
- RSI图共享X轴，确保时间对齐
- 优化子图间距：hspace=0.1，减少顶部和底部空白

### 数据缓存
- RSI数据存储在`self.rsi_df`中
- 在交易日切换时自动清空缓存
- 支持股票代码更新时的数据刷新

### 界面控制
- **顶部工具栏**: 仅在独立窗口模式下显示，嵌入模式下隐藏
- **测试模式**: 支持测试模式切换
- **交易日导航**: 支持前后交易日切换

## 使用方法

### 基本使用
1. 打开分时窗口
2. RSI图自动显示在底部
3. 观察RSI曲线与超买超卖线的位置关系

### 技术分析
- **超买信号**: RSI > 70，可能面临回调
- **超卖信号**: RSI < 30，可能面临反弹
- **中性区域**: RSI在30-70之间，市场相对平衡
- **趋势判断**: 短期RSI与长期RSI的交叉关系

## 注意事项

1. **数据依赖**: RSI计算需要足够的历史数据点
2. **初始化**: 前几个数据点的RSI值可能不稳定
3. **更新同步**: RSI图与分时数据保持同步更新
4. **缓存管理**: 切换交易日时RSI数据会自动刷新

## 扩展性

- 支持自定义RSI周期参数
- 可添加其他技术指标（如MACD、KDJ等）
- 图表布局可灵活调整
- 支持嵌入模式和独立窗口模式

## 测试验证

- RSI计算函数已通过单元测试
- 集成测试验证了数据连续性
- 图表绘制功能正常工作
- 支持不同时间周期的数据
