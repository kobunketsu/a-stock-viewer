# 5分钟K线柱子功能实现

## 功能概述

在分时价格图上叠加绘制半透明的5分钟价格柱子，实现绿跌红涨的K线显示效果。

## 实现细节

### 1. 数据重采样
- 将1分钟分时数据重采样为5分钟K线数据
- 使用`resample('5T')`方法进行重采样
- 聚合规则：
  - `open`: 取第一个值
  - `close`: 取最后一个值
  - `high`: 取最大值
  - `low`: 取最小值
  - `volume`: 求和

### 2. 位置映射
- 将5分钟K线时间戳映射到1分钟时间轴的位置
- 使用时间差计算找到最接近的1分钟时间点
- 确保K线柱子与分时线在时间轴上对齐

### 3. 绘制效果
- **颜色规则**: 绿跌红涨（与中国股市传统相反，符合国际惯例）
  - 上涨：白色填充 + 红边框 (#FF6666)
  - 下跌：绿色填充 (#66CC66)
- **透明度**: 1.0（不透明效果）
- **宽度规则**: 5分钟K线柱子宽度 = 5个1分钟时间单位的80%，形成间隙
- **绘制顺序**: 先绘制K线柱子，再绘制分时曲线叠加
- **K线组成**:
  - 实体：开盘价到收盘价的矩形（宽度=4分钟，不透明，有间隙）
  - 上影线：最高价到实体顶部的线段（从柱子中心开始，线宽1.5）
  - 下影线：最低价到实体底部的线段（从柱子中心开始，线宽1.5）

### 4. 集成位置
- 在分时价格面板中绘制
- 位于分时价格线之后，其他指标之前
- 与现有功能（布林带、买卖信号等）兼容

## 代码位置

### 主要方法
- `_plot_5min_candlesticks()`: 绘制5分钟K线柱子的核心方法
- 在`_draw()`方法中调用，位置在绘制最新价格RSI信号之后

### 调用流程
```
_draw() -> _plot_5min_candlesticks()
```

## 技术特点

1. **性能优化**: 使用numpy数组进行高效计算
2. **错误处理**: 完善的异常捕获和日志记录
3. **数据验证**: 检查数据有效性，避免空数据绘制
4. **兼容性**: 与现有分时窗口功能完全兼容
5. **宽度精确性**: 5分钟K线柱子宽度精确等于5个1分钟时间单位
6. **影线居中**: 上下影线从K线柱子中心开始，视觉效果更佳

## 使用效果

- 提供更直观的5分钟级别价格波动视图
- 柱子间隙设计清晰分离各个时间段，分时曲线叠加在柱子上
- 红边框/绿填充的颜色规则便于快速判断涨跌
- 完整的OHLC信息展示（开盘、最高、最低、收盘）
- 适中的影线宽度清晰显示价格波动范围

## 测试验证

功能已通过独立测试脚本验证：
- 数据重采样正确性
- K线绘制逻辑正确性
- 颜色规则符合预期
- 与分时线的时间轴对齐
