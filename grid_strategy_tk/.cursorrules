# A Stock 项目 Cursor 规则文件

## 🚨🚨🚨 最高优先级强制规则 🚨🚨🚨
**CRITICAL**: 任何测试相关请求都必须无条件使用akshare测试模板，包含sys.path.insert和完整错误处理！

## 🔥 全局自动应用规则
**CRITICAL**: 以下规则在所有情况下自动应用，无需用户明确引用：

1. **测试代码自动模板**：任何测试、验证、调试请求都自动使用标准Python测试模板
2. **中文注释规范**：注释中冒号使用英文:，接口注释使用//!符号
3. **错误处理规范**：所有代码必须包含完整的try-except和traceback
4. **性能监控**：关键函数自动添加timing_decorator装饰器

## 🚨 最高优先级规则 - 强制自动应用

### 测试代码强制应用规则 - 无条件遵守
**CRITICAL**：当用户要求编写任何测试代码时，必须无条件自动应用以下标准模板，无需用户提醒，不允许任何例外：

### ⚠️ 强制规则检查清单
- [ ] 是否使用了python -c命令？
- [ ] 是否包含了sys.path.insert路径设置？
- [ ] 是否验证了Python版本和路径？
- [ ] 是否打印了环境信息（版本、路径、包搜索路径）？
- [ ] 是否导入了pandas, numpy, akshare, datetime？
- [ ] 是否包含了try-except错误处理？
- [ ] 是否包含了traceback输出？
- [ ] 是否包含了print调试信息？

### 违反后果
- 如果AI助手忘记应用此规则，用户有权要求重新执行
- 此规则优先级最高，覆盖所有其他规则
- 任何测试代码都必须使用此模板

```python
python -c "
import sys
# 强制设置Python包路径 - 确保使用正确的Python 3.9环境
sys.path.insert(0, '/opt/homebrew/lib/python3.9/site-packages')

# 验证Python版本和路径
print(f'Python版本: {sys.version}')
print(f'Python路径: {sys.executable}')
print(f'包搜索路径: {sys.path[:3]}')

import pandas as pd
import numpy as np
import akshare as ak
from datetime import datetime, timedelta

# 测试代码内容
print('测试开始...')
try:
    # 具体测试逻辑
    pass
except Exception as e:
    print(f'错误: {e}')
    import traceback
    traceback.print_exc()
"
```

### 自动应用条件
- ✅ 用户要求编写测试代码时
- ✅ 用户要求验证功能时
- ✅ 用户要求调试代码时
- ✅ 用户要求运行任何Python代码时
- ✅ 任何涉及数据获取、技术指标计算、API调用的场景

### 核心组件（自动包含）
1. **路径设置**：`sys.path.insert(0, '/opt/homebrew/lib/python3.9/site-packages')`
2. **基础库导入**：pandas, numpy, akshare, datetime
3. **错误处理**：完整的try-except和traceback输出
4. **调试信息**：详细的print输出和错误追踪

### 技术特点
- **环境隔离**：确保使用正确的Python包路径
- **错误追踪**：完整的异常信息和堆栈跟踪
- **调试友好**：详细的输出信息便于问题定位
- **可重复性**：标准化的测试环境确保结果一致

## 代码风格规范

### 中文注释规范
- 注释中的冒号：改用英文:代替
- 接口注释开头使用//!符号代表接口内容锁定
- 避免在注释中使用emoji

### 代码生成规则
- 完整理解和记住所有规则，避免习惯性思维
- 避免直接编写代码，先检查规范化工作流
- 避免命名冲突
- 接口设计优先

### 代码重构规范
- 每次更改时最小化git更改变动
- 必须确认重构任务的重构类型
- 拆分类型任务要求：
  1. 利用IDE接口分组标签来快速判断需要移动的代码块
  2. 选中代码，裁剪到剪贴板，再粘贴到目标文件
  3. 解决导入文件路径变更问题
  4. 保留被注释的文本，代码和其他IDE标签
  5. 对应测试也要拆分
  6. 对比原文件总代码行数，确保误差在大约2%以内，98-102%之间

### 性能监控规范
- 关键函数必须添加timing_decorator装饰器
- 耗时超过100ms的函数需要优化
- 定期检查性能日志
- 对比历史性能数据

## 项目特定规则

### 股票分析系统
- 所有技术指标计算必须基于标准算法
- RSI计算使用指数移动平均（EMA）方法
- KDJ参数根据交易策略优化：(55,21,5)用于高低点捕捉
- 分时数据必须包含前一交易日收盘价用于连续性计算

### 数据获取规范
- 使用akshare作为主要数据源
- 实现多API备用机制提高可靠性
- 所有API调用必须包含错误处理
- 数据缓存机制提高性能

### 信号系统规范
- 所有买卖信号必须经过延迟验证
- 信号优先级：机构信号 > 技术指标信号 > 基础信号
- 假信号检测基于RSI差值条件
- 信号显示格式统一：买入信号显示"买1"，卖出信号显示"卖1"

## 错误处理规范
- 异步错误传递必须序列化异常信息
- 使用`error_msg = str(e)`代替直接引用异常对象
- 所有API调用必须包含try-catch块
- 错误日志必须包含时间戳和详细上下文

## 测试规范
- 测试驱动的开发意识，应该先写测试用例，再写实现代码
- 深入理解框架的机制，特别是核心概念
- 写新代码前查看其他用例的类似代码，复用已经验证过的代码模式
- 先写失败的测试，遵循"红-绿-重构"的TDD流程
- 测试独立性，不依赖于外部条件和其他测试状态，多使用Mock代替

## ⚠️ 重要提醒
**AI助手必须遵守**：
- 当用户要求编写任何测试代码时，必须自动使用文件开头的标准测试模板
- 当用户要求验证功能时，必须自动使用标准测试模板
- 当用户要求调试代码时，必须自动使用标准测试模板
- 无需用户明确引用此规则文件，这些规则在所有情况下自动生效
- 如果忘记应用这些规则，用户有权提醒并要求重新执行
